<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco-Carbon San Mart√≠n - LACNet Interface</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; color: #2E7D32; margin-bottom: 30px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; background-color: #fafafa; }
        button { background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #45a049; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .result { background-color: #e8f5e8; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; }
        .error { background-color: #ffe6e6; color: #d00; padding: 10px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± Eco-Carbon San Mart√≠n</h1>
            <h2>Interfaz LACNet Blockchain</h2>
            <p>Interacci√≥n directa con contratos inteligentes desplegados</p>
        </div>

        <div class="section">
            <h3>üìù SimpleGreeting Contract</h3>
            <button onclick="getGreeting()">Obtener Saludo Actual</button>
            <input type="text" id="newGreeting" placeholder="Nuevo saludo...">
            <button onclick="updateGreeting()">Actualizar Saludo</button>
            <div id="greetingResult" class="result" style="display:none;"></div>
        </div>

        <div class="section">
            <h3>üíæ SimpleStorage Contract</h3>
            <input type="text" id="storageKey" placeholder="Clave (ej: tons_processed)">
            <input type="number" id="storageValue" placeholder="Valor">
            <button onclick="storeData()">Almacenar Datos</button>
            <button onclick="getData()">Obtener Datos</button>
            <div id="storageResult" class="result" style="display:none;"></div>
        </div>

        <div class="section">
            <h3>üå± EcoCarbonToken Contract</h3>
            <button onclick="getTokenInfo()">Informaci√≥n del Token</button>
            <input type="text" id="walletAddress" placeholder="Direcci√≥n de billetera">
            <button onclick="getBalance()">Consultar Balance</button>
            <div id="tokenResult" class="result" style="display:none;"></div>
        </div>

        <div class="section">
            <h3>‚öôÔ∏è Configuraci√≥n de Red</h3>
            <p><strong>Red:</strong> LACChain Testnet</p>
            <p><strong>RPC URL:</strong> <span id="rpcUrl">https://writer.lacchain.net</span></p>
            <button onclick="connectWallet()">Conectar Wallet</button>
            <div id="connectionStatus" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        const contracts = {
            SimpleGreeting: "0x...",
            SimpleStorage: "0x...",
            EcoCarbonToken: "0x..."
        };

        const abis = {
            SimpleGreeting: [
                "function getGreeting() view returns (string)",
                "function updateGreeting(string memory _newGreeting)",
                "event GreetingUpdated(string newGreeting, address updatedBy)"
            ],
            SimpleStorage: [
                "function getCarbonData(string memory key) view returns (uint256)",
                "function storeCarbonData(string memory key, uint256 value)",
                "event DataStored(string key, uint256 value, address storedBy)"
            ],
            EcoCarbonToken: [
                "function name() view returns (string)",
                "function symbol() view returns (string)",
                "function decimals() view returns (uint8)",
                "function totalSupply() view returns (uint256)",
                "function balanceOf(address owner) view returns (uint256)"
            ]
        };

        let provider;

        async function connectWallet() {
            try {
                provider = new ethers.providers.JsonRpcProvider("https://writer.lacchain.net");
                const network = await provider.getNetwork();
                document.getElementById('connectionStatus').style.display = 'block';
                document.getElementById('connectionStatus').innerHTML = 
                    `‚úÖ Conectado a LACChain<br>
                     Network ID: ${network.chainId}<br>
                     Network Name: ${network.name || 'LACChain'}`;
            } catch (error) {
                showError('connectionStatus', 'Error conectando a LACChain: ' + error.message);
            }
        }

        async function getGreeting() {
            try {
                const contract = new ethers.Contract(contracts.SimpleGreeting, abis.SimpleGreeting, provider);
                const greeting = await contract.getGreeting();
                showResult('greetingResult', `Saludo actual: "${greeting}"`);
            } catch (error) {
                showError('greetingResult', 'Error: ' + error.message);
            }
        }

        async function updateGreeting() {
            const newGreeting = document.getElementById('newGreeting').value;
            if (!newGreeting) {
                showError('greetingResult', 'Por favor ingresa un nuevo saludo');
                return;
            }
            showResult('greetingResult', 'Actualizando saludo... (requiere wallet conectada)');
        }

        async function storeData() {
            const key = document.getElementById('storageKey').value;
            const value = document.getElementById('storageValue').value;
            if (!key || !value) {
                showError('storageResult', 'Por favor ingresa clave y valor');
                return;
            }
            showResult('storageResult', `Almacenando: ${key} = ${value} (requiere wallet conectada)`);
        }

        async function getData() {
            try {
                const key = document.getElementById('storageKey').value;
                if (!key) {
                    showError('storageResult', 'Por favor ingresa una clave');
                    return;
                }
                const contract = new ethers.Contract(contracts.SimpleStorage, abis.SimpleStorage, provider);
                const value = await contract.getCarbonData(key);
                showResult('storageResult', `${key}: ${value.toString()}`);
            } catch (error) {
                showError('storageResult', 'Error: ' + error.message);
            }
        }

        async function getTokenInfo() {
            try {
                const contract = new ethers.Contract(contracts.EcoCarbonToken, abis.EcoCarbonToken, provider);
                const [name, symbol, decimals, totalSupply] = await Promise.all([
                    contract.name(),
                    contract.symbol(),
                    contract.decimals(),
                    contract.totalSupply()
                ]);
                showResult('tokenResult', 
                    `Nombre: ${name}<br>
                     S√≠mbolo: ${symbol}<br>
                     Decimales: ${decimals}<br>
                     Suministro Total: ${ethers.utils.formatUnits(totalSupply, decimals)} ${symbol}`
                );
            } catch (error) {
                showError('tokenResult', 'Error: ' + error.message);
            }
        }

        async function getBalance() {
            try {
                const address = document.getElementById('walletAddress').value;
                if (!address) {
                    showError('tokenResult', 'Por favor ingresa una direcci√≥n');
                    return;
                }
                const contract = new ethers.Contract(contracts.EcoCarbonToken, abis.EcoCarbonToken, provider);
                const balance = await contract.balanceOf(address);
                const decimals = await contract.decimals();
                const symbol = await contract.symbol();
                showResult('tokenResult', 
                    `Balance de ${address}:<br>
                     ${ethers.utils.formatUnits(balance, decimals)} ${symbol}`
                );
            } catch (error) {
                showError('tokenResult', 'Error: ' + error.message);
            }
        }

        function showResult(elementId, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'result';
            element.innerHTML = message;
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'error';
            element.innerHTML = message;
        }

        window.onload = function() { connectWallet(); };
    </script>
</body>
</html>
